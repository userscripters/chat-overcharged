"use strict";var __awaiter=this&&this.__awaiter||function(e,o,l,s){return new(l=l||Promise)(function(n,t){function r(e){try{i(s.next(e))}catch(e){t(e)}}function a(e){try{i(s.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(r,a)}i((s=s.apply(e,o||[])).next())})},__generator=this&&this.__generator||function(n,r){var a,i,o,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,i=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(o=0<(o=l.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){l.label=t[1];break}if(6===t[0]&&l.label<o[1]){l.label=o[1],o=t;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(t);break}o[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},__spreadArray=this&&this.__spreadArray||function(e,t){for(var n=0,r=t.length,a=e.length;n<r;n++,a++)e[a]=t[n];return e};!function(r,b){function c(){return function(e,t){var n="http://www.w3.org/2000/svg",r=document.createElementNS(n,"svg");r.classList.add("svg-icon",e),r.setAttribute("width","18"),r.setAttribute("height","18"),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("aria-hidden","true");n=document.createElementNS(n,"path");return n.setAttribute("d",t),r.append(n),r}("iconClear","M15 4.41 13.59 3 9 7.59 4.41 3 3 4.41 7.59 9 3 13.59 4.41 15 9 10.41 13.59 15 15 13.59 10.41 9 15 4.41z")}function v(e,t){var n=e.id;return(e=document.createElement("label")).htmlFor=n,e.textContent=t,e}function p(e){var t=r.getSelection();if(t){var n=t.anchorNode;if(n&&n.id===e)return t}}var n={ids:{chat:{input:"input",anchor:"bubble"},links:{form:"link-form",modal:"link-modal"},quotas:{api:"api-quotas"}},classes:{links:{modal:"link-modal"},styles:{collapsed:"collapsed",primaryBckg:"bckg-primary",primaryColor:"color-primary"},quotas:{api:"api-quotas"}}};!function(e){var t=b.createElement("style");b.head.append(t);var n,r=t.sheet;r&&(t=(n=e.classes).links,e=n.styles,n=n.quotas,r.insertRule("\n        :root {\n            --white: #c4c8cc;\n            --black: #2d2d2d;\n            --button-primary: #378ad3;\n        }"),r.insertRule("\n        ."+e.primaryBckg+" {\n            background-color: var(--black) !important;\n        }"),r.insertRule("\n        ."+e.primaryColor+" {\n            color: var(--white) !important;\n        }"),r.insertRule("\n        ."+t.modal+" .iconClear {\n            position: absolute;\n            top: 0;\n            right: 0;\n            margin: 1vh;\n            fill: var(--white);\n        }"),r.insertRule("\n        ."+t.modal+" {\n            position: fixed;\n            top: calc(100% / 3);\n            left: calc(100% / 3);\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            border-radius: 1vh;\n            z-index: 9999;\n            max-width: 50vw;\n            max-height: 25vh;\n            overflow: hidden;\n\n            transition: max-width 0.1s linear, max-height 0.1s linear;\n        }"),r.insertRule("\n        ."+e.collapsed+" {\n            max-width: 0px !important;\n            max-height: 0px !important;\n        }"),r.insertRule("\n        ."+t.modal+" form {\n            padding: 1vh 1vw;\n        }"),r.insertRule("\n        ."+t.modal+" input {\n            box-sizing: border-box;\n            border-radius: 0.5vh;\n            padding: 1vh 1vw;\n            width: 100%;\n            outline: none;\n            background: none;\n            color: var(--white);\n        }"),r.insertRule("\n        ."+t.modal+" label {\n            display: inline-block;\n            margin: 0 0 1vh 0.25vw;\n            color: var(--white);\n            font-size: 0.9rem;\n        }"),r.insertRule("\n        ."+t.modal+" button {\n            height: 4vh;\n            min-width: 8vh;\n            border-radius: 0.5vh 0.5vw;\n            border: none;\n            background-color: rgb(55, 138, 211);\n            color: white;\n        }"),r.insertRule("\n        ."+t.modal+" button:hover {\n            background-color: #3ca4ff;\n        }"),r.insertRule("\n        ."+t.modal+" ."+n.api+" {\n            cursor: initial;\n            margin-left: 0.5vw;\n            color: var(--black);\n            transition: color 0.5s linear 0s;\n        }"),r.insertRule("\n        ."+t.modal+" input {\n            margin-bottom: 1vh;\n        }"))}(n);var a=[{key:"L",ctrl:!0,shift:!1,caseSensitive:!1,action:function(e){var u=e.ids,d=e.classes,t=p(u.chat.anchor),n=d.styles.collapsed,r=(null==t?void 0:t.toString())||"",a=b.getElementById(u.links.modal);if(a)return function(e,t,n){var r=e.classList,a=r.contains(n),e=__read(__spreadArray([],__read(e.querySelectorAll("input"))),2);e[0];return e[1].value=t,a&&r.remove(n)}(a,r,n);var i=b.createElement("div");i.classList.add(d.links.modal,d.styles.primaryBckg,n),i.id="link-modal";var o=c();o.addEventListener("click",function(){i.classList.add(n)});var l=b.createElement("form");l.id=u.links.form;var f=b.createElement("input");f.type="text";var m=b.createElement("input");m.type="text",m.value=r;var s=function(e,t){var n=document.createElement("span");n.classList.add(t),n.textContent="SE API quota remaining: ";t=document.createElement("span");return t.id=e,n.append(t),n}(u.quotas.api,d.quotas.api),y=300;f.addEventListener("change",function(){return __awaiter(void 0,void 0,void 0,function(){var o,l,s,c;return __generator(this,function(e){switch(e.label){case 0:return o=f.value,/https?:\/\/(www\.)?(meta\.)?stackoverflow\.com/.test(o)?[4,(v=o,p=y,void 0===h&&(h="stackoverflow"),__awaiter(void 0,void 0,void 0,function(){var t,n,r,a,i,o,l,s,c,u,d;return __generator(this,function(e){switch(e.label){case 0:t=["https?:\\/\\/stackoverflow\\.com\\/questions\\/\\d+\\/.+?\\/(\\d+)","https?:\\/\\/"+h+".com\\/questions\\/(\\d+)\\/.+?(?:\\/(\\d+)|$)","https?:\\/\\/"+h+".com\\/(?:a|q)\\/(\\d+)"];try{for(r=__values(t),a=r.next();!a.done;a=r.next())if(i=a.value,o=new RegExp(i,"i"),l=__read(v.match(o)||[],2),s=l[1]){n=s;break}}catch(e){u={error:e}}finally{try{a&&!a.done&&(d=r.return)&&d.call(r)}finally{if(u)throw u.error}}return d=["",p],n?[4,fetch("https://api.stackexchange.com/2.2/posts/"+n+"?site="+h+"&filter=Bqe1ika.a")]:[2,d];case 1:return(c=e.sent()).ok?[4,c.json()]:[2,d];case 2:return(u=e.sent(),c=u.items,u=u.quota_remaining,c.length)?(c=__read(c,1),[2,[c[0].title,u]]):[2,d]}})}))]:[3,2];case 1:return s=__read.apply(void 0,[e.sent(),2]),l=s[0],s=s[1],m.value||(m.value=l),y=s,[2,(t=u.quotas.api,n=d.styles.primaryColor,a=y,void(!(t=b.getElementById(t))||(i=t.parentElement)&&(t.textContent=a.toString(),i.classList.add(n),setTimeout(function(){return i.classList.remove(n)},3e3))))];case 2:return m.value?[3,4]:(c=m,[4,(r=o,__awaiter(void 0,void 0,void 0,function(){var t,n;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,fetch(r)];case 1:return 200!==(t=e.sent()).status?[2,""]:[4,t.text()];case 2:return t=e.sent(),n=(new DOMParser).parseFromString(t,"text/html"),t=n.querySelector("[property='og:title']"),n=n.title,[2,t?t.content:n];case 3:return n=e.sent(),console.debug("failed to fetch link or parse: "+n),[2,""];case 4:return[2]}})}))]);case 3:c.value=e.sent(),e.label=4;case 4:return[2]}var r,t,n,a,i,v,p,h})})});e=v(f,"Link"),t=v(m,"Title"),a="Add link",(r=document.createElement("button")).type="button",r.textContent=a;r.addEventListener("click",function(){var e="["+m.value+"]("+f.value+")";!function(e,t,n){t=b.getElementById(t);if(!t)return;e=p(e),e=(null==e?void 0:e.toString())||"";t.value=t.value.replace(e,n)}(u.chat.anchor,u.chat.input,e),i.classList.add(n)}),l.append(e,f,t,m,r,s),i.append(o,l),b.body.append(i),i.classList.remove(n)}}];b.addEventListener("keydown",function(e){var i=e.ctrlKey,o=e.metaKey,l=e.shiftKey,s=e.key,t=a.find(function(e){return t=e,n=o,r=l,a=e.ctrl,t=e.shift,(i===a||n===a)&&r===t&&(r=s,t=e.key,e.caseSensitive?t===r:t.toUpperCase()===r.toUpperCase());var t,n,r,a});t&&(e.preventDefault(),(0,t.action)(n,t))})}(window,document);